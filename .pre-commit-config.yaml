# Pre-commit hooks configuration for tandem-fetch
# See https://prek.j178.dev/ for more information
# Run hooks manually: uv run prek run --all-files

repos:
  # Builtin hooks: Fast file validation (offline, instant)
  - repo: builtin
    hooks:
      - id: trailing-whitespace
        args: ['--markdown-linebreak-ext=md']
      - id: end-of-file-fixer
      - id: mixed-line-ending
        args: ['--fix=lf']
      - id: check-yaml
        exclude: 'specs/.*/contracts/.*\.yaml$'  # Exclude contract schema files
      - id: check-toml
      - id: check-json
      - id: check-added-large-files
        args: ['--maxkb=1000']
      - id: check-case-conflict
      - id: check-merge-conflict

  # Ruff: Fast Python linter and formatter
  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.14.14
    hooks:
      # Run linter first (with --fix to auto-fix issues)
      - id: ruff
        args: [--fix, --exit-non-zero-on-fix]
      # Run formatter second
      - id: ruff-format

  # Gitleaks: Secret detection
  - repo: https://github.com/gitleaks/gitleaks
    rev: v8.24.3
    hooks:
      - id: gitleaks

  # Pytest: Run tests before push (not on commit)
  - repo: local
    hooks:
      - id: pytest-fast
        name: pytest-fast
        entry: uv run pytest
        args: ['-m', 'not slow', '-n', 'auto', '-x', '--tb=short', '-q']
        language: system
        pass_filenames: false
        always_run: true
        stages: [pre-push]
